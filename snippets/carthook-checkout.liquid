{% if customer %}
	<script  type="text/javascript">
		window.ch_cust_param = 'customer_id={{customer.id}}&customer_email={{customer.email}}&email={{customer.email}}';
		var ch_sd = btoa(JSON.stringify({
			"id": {{customer.id | json}},
			"email": {{customer.email | json}},
			"default_address": {{customer.default_address | json}},
			"accepts_marketing": {{customer.accepts_marketing | json}},
			"tags": {{customer.tags | json}}
		}));
		sessionStorage.setItem("ch_sd", ch_sd);
	</script>
{% endif %}

<script  type="text/javascript">
	// fetch.js
	;window.carthookFetch="2.5";window.replaced_selectors=[];window.chRechargeHandleMap=window.chRechargeHandleMap||{};(function(t){var a="form[action^='/cart']:not(form[action='/cart/add']), form[action^='/checkout']",u="input[name='checkout'][type='submit'], input[type='submit'], #recharge_button",s=".carthook_checkout, [name='update'], [name='add']",l="button[name='checkout'][type='submit'], button[type='button'].checkout",h=".carthook_checkout",d="a[name='checkout']:not(a[href='/cart'])",f=".carthook_checkout",w="input[type='checkbox']#agree",p="#cartSpecialInstructions, #CartSpecialInstructions",m="[name^=\"attributes\"]",o=!1,r=!1,n="carthook_ignore";window.chCartToken=null;window.chScriptLoaded=!1;var i="https://gcheck.carthook.com";t.getScript(i,function(){window.chScriptLoaded=!0});function k(t,e,r){var o=function(e,n){return function(){if(typeof n==="undefined"||n-->0){setTimeout(o,e);try{t.call(null)}catch(r){n=0;throw r.toString()}}}}(e,r);try{t.call(null)}catch(n){console.error(n)};setTimeout(o,e)};function g(){var p=a.split(", "),m=u.split(", "),k=l.split(", "),g=d.split(", "),r="",c="",i="";for(var t=0;t<p.length;t++){var w=p[t];if(t>0&&t<p.length){r+=", ";c+=", ";i+=", "};for(var o=0;o<m.length;o++){if((o>0))r+=", ";var b=m[o];r+=w+" "+b+":not("+s+")"};for(var n=0;n<k.length;n++){if((n>0))c+=", ";var y=k[n];c+=w+" "+y+":not("+h+")"};for(var e=0;e<g.length;e++){if((e>0))i+=", ";var v=g[e];i+=w+" "+v+":not("+f+")"}};return[r,c,i]};function v(t){return(document.cookie.match("(^|; )"+t+"=([^;]*)")||0)[2]};function e(t,e){if(window.ch_debug)console.log(t,e)};function y(){e("Cart Token: ",window.chCartToken);var a="",u=t(p);if(u.length>0){u.each(function(){if($(this).val()!=""){a="&additionalNote="+encodeURIComponent($(this).val());return!1}})};var r=[],c="",i=t(m);if(i.length>0){i.each(function(){r.push({"name":this.id?this.id:this.name,"value":this.value})});c="&noteAttributes="+encodeURIComponent(JSON.stringify(r))};var o="";if(window.chCouponCode&&(typeof window.chCouponCode!="undefined")){o="&coupon="+window.chCouponCode};if(window.chCartToken!=null){var n="https://familygiftsco.com/a/secure/checkout/OKNzYlSOnO80K8rzd7MF?cart_token="+window.chCartToken+o+a+c,s=!1;if(window.ch_cust_param!=null)n+="&"+window.ch_cust_param;e("Checkout URL: ",n);window.location.href=n}};window.redirectToOriginal=function(n){var r=t(window.replaced_selectors[n]),c=r.get(0).tagName.toLowerCase();e("Tag name: ",c);if(c=="a"){var o=r.attr("href");if((o=="")||(o==null)||(typeof o=="undefined")){r[0].click()}else{e("Redirecting to a with ref: ",o);window.location.href=o}}else{r.click()}};function b(t){return t&&t.properties&&t.properties.shipping_interval_frequency};function C(t,e){if(!b(t)){return t.handle};if(window.chRechargeHandleMap[t.handle]){return window.chRechargeHandleMap[t.handle]};var n=t.handle.match(/(.*)-[0-9]+$/);if(!n){return t.handle};return n[1]};function c(e){return new Promise(function(n,o){t.ajax({type:"GET",url:e,dataType:"json",success:n,error:o,})})};function T(t){return c("/products/"+t+".js")};function R(){return c("/cart.json")};function A(t){var o=C(t);e("Fetching",o);return new Promise(function(t,r){T(o).then(function(e){var o=e.tags;if(!o||o.length===0){t(!1);return};if(o.some(function(t){return t.trim().toLowerCase()===n})){t(n);return};var r=o.reduce(function(t,e){return t||e.trim().toLowerCase()==="carthook_checkout"},!1);t(r)})["catch"](function(n){e("Product fetch err "+o+": "+n.status);t(!1)})})};function L(t){return new Promise(function(t,o){R().then(function(e){window.chCartToken=e.token||v("cart");if(!e.items){o("No items in the cart");return};var r=e.items.map(function(t){return A(t,!0)});Promise.all(r).then(function(e){if(e.indexOf(n)>-1){t(!1)}else{t(e.indexOf(!0)>-1)}})["catch"](function(t){o(t)})})["catch"](function(t){e("Error grabbing Shopify cart: "+t);o(t)})})};window.testGlobalBeforeReact=function(t){if(!r){r=!0;if(window.chScriptLoaded){window.react(t)}else{window.redirectToOriginal(t)}}};window.react=function(n){var r=t(w),i=!r.length;if(r.length>0){r.each(function(e,n){if(t(n).is(":checked")){i=!0}})};if(!i){alert("You must agree to the Terms and Conditions first");return};if(o){window.redirectToOriginal(n);return};try{L().then(function(t){if(t){y()}else{redirectToOriginal(n)}})["catch"](function(t){e("Cart fetch error: ",t);window.redirectToOriginal(n)})}catch(c){e("Error when redirecting with error object: ",c);o=!0;window.redirectToOriginal(n)}};t(document).ready(function(){var n=g(),r="input.carthook_checkout:not([class*=\"elm_pos_\"]), .carthook_checkout[name=\"checkout\"]:not([class*=\"elm_pos_\"]) { display: none !important; }";t("<style id=\"ch-btn-style\">"+r+"</style>").appendTo(document.head);var o=function(){e("run");t(n[0]).each(function(n,o){var n=window.replaced_selectors.length;t(o).addClass("carthook_checkout");window.replaced_selectors.push(o);var r=document.createElement("input"),i=t(o).attr("class"),c=t(o).attr("style");r.setAttribute("type","submit");r.setAttribute("value",o.value);r.setAttribute("class",i);r.className+=" carthook_checkout elm_pos_"+n;if(typeof c!="undefined")r.setAttribute("style",c);t(r).insertAfter($(o));t(o).attr("style","display:none !important");t(r).on("click touchstart",function(t){t.preventDefault();window.testGlobalBeforeReact(n)});e("Replaced: ",o,"with: ",r)});t(n[1]).each(function(n,o){var n=window.replaced_selectors.length;t(o).addClass("carthook_checkout");window.replaced_selectors.push(o);var r=document.createElement("button"),i=t(o).attr("class"),c=t(o).attr("style"),a=o.innerHTML;r.setAttribute("type","submit");r.setAttribute("class",i);r.className+=" carthook_checkout elm_pos_"+n;if(typeof c!="undefined")r.setAttribute("style",c);t(r).html(a);t(r).insertAfter($(o));t(o).hide();t(r).on("click touchstart",function(t){t.preventDefault();window.testGlobalBeforeReact(n)});e("Replaced: ",o,"with: ",r)});t(n[2]).each(function(n,o){var n=window.replaced_selectors.length;t(o).addClass("carthook_checkout");window.replaced_selectors.push(o);var r=document.createElement("a"),i=t(o).attr("class"),c=t(o).attr("style"),a=o.innerHTML;r.setAttribute("class",i);r.className+=" carthook_checkout elm_pos_"+n;if(typeof c!="undefined")r.setAttribute("style",c);t(r).html(a);t(r).insertAfter($(o));t(o).hide();t(r).on("click touchstart",function(t){t.preventDefault();window.testGlobalBeforeReact(n)});e("Replaced: ",o,"with: ",r)})};k(function(){o()},350)})})(jQuery);
</script>